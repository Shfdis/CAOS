
Исполнитель: Ермошкин А. Д.
Группа: 245
Вариант: 36

Условие задачи

Разработать 4 программы для проведения турнира с использованием POSIX семафоров и различных механизмов межпроцессного взаимодействия.

Сценарий задачи

Турнир "Камень-Ножницы-Бумага" моделируется как система взаимодействующих процессов:
- Игроки (процессы) делают случайный выбор (Камень/Ножницы/Бумага)
- Координатор (процесс) организует матчи между игроками попарно
- В каждом матче два игрока синхронизируются через семафоры
- Результаты передаются через разделяемую память
- Турнир проводится в виде последовательных раундов до определения победителя
- Наблюдатели (процессы) получают информацию о ходе турнира

Программа 1 (4-6 баллов)

Сценарий: Родительский процесс-координатор запускает дочерние процессы для каждого матча. Игроки синхронизируются через неименованные семафоры в разделяемой памяти.

Механизмы IPC:
- Неименованные POSIX семафоры (sem_init) в разделяемой памяти
- Разделяемая память POSIX 

Завершение: По завершении турнира или по SIGINT (Ctrl+C). Автоматическая очистка через sem_destroy и munmap.

Запуск: cd program1 && ./test.sh
Или: gcc -Wall -Wextra -std=c11 -D_GNU_SOURCE -I../common program1.c ../common/tournament.c -o program1 -lrt -lpthread && ./program1
Введите количество игроков при запросе.

Результаты: Программа успешно проводит турнир, определяет победителя, корректно завершается по SIGINT.

Программа 2 (7-8 баллов)

Сценарий: Независимые процессы запускаются в разных консолях. Координатор создает IPC ресурсы, игроки подключаются и участвуют в матчах.

Механизмы IPC:
- Именованные POSIX семафоры (sem_open)
- Именованная разделяемая память (shm_open)

Завершение: По завершении турнира или по SIGINT. Очистка через unlink_all_ipc (sem_unlink, shm_unlink).

Запуск:
1. cd program2
2. ./test.sh 
3. Или вручную: скомпилируйте через test.sh, затем:
   - Терминал 1: ./program2_coordinator (введите количество игроков)
   - Терминал 2: ./program2_player 1
   - Терминал 3: ./program2_player 2
   - Терминал 4: ./program2_player 3
   - Терминал 5: ./program2_player 4
   - В терминале 1 нажмите Enter

Результаты: Независимые процессы успешно взаимодействуют, турнир завершается с определением победителя.

Программа 3 (9 баллов)

Сценарий: Добавлен процесс-наблюдатель, получающий информацию через именованный канал (FIFO). Координатор и игроки отправляют информацию наблюдателю.

Механизмы IPC:
- Именованные POSIX семафоры (sem_open)
- Именованная разделяемая память (shm_open)
- Именованный канал (mkfifo, open, write, read)

Завершение: По завершении турнира или по SIGINT. Очистка через unlink_all_ipc включая unlink(FIFO_NAME).

Запуск:
1. cd program3
2. ./test.sh (компилирует и тестирует)
3. Или вручную: скомпилируйте через test.sh, затем:
   - Терминал 1: ./program3_coordinator (введите количество игроков)
   - Терминал 2: ./program3_observer
   - Терминал 3: ./program3_player 1
   - Терминал 4: ./program3_player 2
   - Терминал 5: ./program3_player 3
   - Терминал 6: ./program3_player 4
   - В терминале 1 нажмите Enter

Результаты: Наблюдатель получает всю информацию о турнире, все процессы работают корректно.

Программа 4 (10 баллов)

Сценарий: Поддержка нескольких наблюдателей через очередь сообщений POSIX. Каждый наблюдатель получает всю информацию о турнире.

Механизмы IPC:
- Именованные POSIX семафоры (sem_open)
- Именованная разделяемая память (shm_open)
- Очередь сообщений POSIX (mq_open, mq_send, mq_receive)

Завершение: По завершении турнира или по SIGINT. Очистка через unlink_all_ipc включая mq_unlink.

Запуск:
1. cd program4
2. ./test.sh (компилирует и тестирует)
3. Или вручную: скомпилируйте через test.sh, затем:
   - Терминал 1: ./program4_coordinator (введите количество игроков)
   - Терминал 2: ./program4_observer
   - Терминал 3: ./program4_observer (можно несколько)
   - Терминал 4: ./program4_player 1
   - Терминал 5: ./program4_player 2
   - Терминал 6: ./program4_player 3
   - Терминал 7: ./program4_player 4
   - В терминале 1 нажмите Enter

Результаты: Несколько наблюдателей работают одновременно, каждый получает всю информацию о турнире.

Аргументы командной строки

Игроки принимают player_id как аргумент: ./program*_player <player_id>
Координаторы запрашивают количество игроков интерактивно при запуске.

Очистка ресурсов

Все программы автоматически очищают ресурсы при завершении:
- Программа 1: sem_destroy, munmap
- Программы 2-4: sem_unlink, shm_unlink, unlink(FIFO_NAME), mq_unlink

При некорректном завершении можно очистить вручную:
sem_unlink /tournament_sem_p1
sem_unlink /tournament_sem_p2
sem_unlink /tournament_sem_result
sem_unlink /tournament_sem_ready
shm_unlink /tournament_shm
unlink /tmp/tournament_fifo
mq_unlink /tournament_mq

Тестирование

Каждая программа имеет тестовый скрипт test.sh в своем каталоге. Скрипты компилируют программы и запускают процессы в фоновом режиме для параллельного тестирования.

Результаты тестирования:

Программа 1: Турнир успешно проводится, победитель определяется корректно.
Программа 2: Независимые процессы взаимодействуют через именованные семафоры и разделяемую память.
Программа 3: Наблюдатель получает информацию через именованный канал.
Программа 4: Несколько наблюдателей работают одновременно через очередь сообщений.
